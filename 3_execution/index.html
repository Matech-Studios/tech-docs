
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <meta name="author" content="Matech Studios">
      
      
        <link rel="canonical" href="https://github.com/Matech-Studios/tech_docs/3_execution/">
      
      <link rel="icon" href="../img/matech.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.2.5">
    
    
      
        <title>Chapter 3: Execution - Matech Studios - Playbook: Recipes Recommender</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.be71726b.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7C&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:""}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="black">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
      <script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#chapter-3-execution" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Matech Studios - Playbook: Recipes Recommender" class="md-header__button md-logo" aria-label="Matech Studios - Playbook: Recipes Recommender" data-md-component="logo">
      
  <img src="../img/matech.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Matech Studios - Playbook: Recipes Recommender
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Chapter 3: Execution
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="black"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7 10a2 2 0 0 1 2 2 2 2 0 0 1-2 2 2 2 0 0 1-2-2 2 2 0 0 1 2-2m10-3a5 5 0 0 1 5 5 5 5 0 0 1-5 5H7a5 5 0 0 1-5-5 5 5 0 0 1 5-5h10M7 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3h10a3 3 0 0 0 3-3 3 3 0 0 0-3-3H7z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="black"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href=".." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../0_preface/" class="md-tabs__link md-tabs__link--active">
        Contents
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../how-to/data_quality_control/" class="md-tabs__link">
        How-To Guides
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Matech Studios - Playbook: Recipes Recommender" class="md-nav__button md-logo" aria-label="Matech Studios - Playbook: Recipes Recommender" data-md-component="logo">
      
  <img src="../img/matech.png" alt="logo">

    </a>
    Matech Studios - Playbook: Recipes Recommender
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      <label class="md-nav__link" for="__nav_2">
        Contents
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Contents" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Contents
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../0_preface/" class="md-nav__link">
        Preface
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../1_understanding/" class="md-nav__link">
        Chapter 1: Understanding
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../2_preparation/" class="md-nav__link">
        Chapter 2: Preparation
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Chapter 3: Execution
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Chapter 3: Execution
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#initial-analysis" class="md-nav__link">
    Initial analysis
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#new-data-source" class="md-nav__link">
    New data source
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ingredients-classification" class="md-nav__link">
    Ingredients classification
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recommender-approach" class="md-nav__link">
    Recommender approach
  </a>
  
    <nav class="md-nav" aria-label="Recommender approach">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#approach-1-basic-scores" class="md-nav__link">
    Approach 1: Basic Scores
  </a>
  
    <nav class="md-nav" aria-label="Approach 1: Basic Scores">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#idea" class="md-nav__link">
    Idea
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metrics" class="md-nav__link">
    Metrics
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#approach-2-weight-ingredients" class="md-nav__link">
    Approach 2: Weight Ingredients
  </a>
  
    <nav class="md-nav" aria-label="Approach 2: Weight Ingredients">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#idea_1" class="md-nav__link">
    Idea
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#service-development" class="md-nav__link">
    Service development
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing" class="md-nav__link">
    Testing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment" class="md-nav__link">
    Deployment
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../4_acceptance/" class="md-nav__link">
        Chapter 4: Acceptance
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../5_epilogue/" class="md-nav__link">
        Epilogue
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      <label class="md-nav__link" for="__nav_3">
        How-To Guides
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="How-To Guides" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          How-To Guides
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../how-to/data_quality_control/" class="md-nav__link">
        Data Quality Control
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="chapter-3-execution">Chapter 3: Execution<a class="headerlink" href="#chapter-3-execution" title="Permanent link">&para;</a></h1>
<div class="admonition abstract">
<p class="admonition-title">Abstract</p>
<p>This chapter covers the execution of the work based on the previous definitions done, in terms of developing, testing, and validating the solutions based on the agreed acceptance criteria. (<strong>10 min read</strong>)</p>
</div>
<h2 id="initial-analysis">Initial analysis<a class="headerlink" href="#initial-analysis" title="Permanent link">&para;</a></h2>
<p>Once the repository was prepared, and the initial requirements were defined, we should start from the analysis of the available data to check the following aspects:
- Available information to be used for the recommender schema
- Quality of data, and corrections to be done
- Pre-processing steps required to use the data</p>
<p>The first data source implemented was <a href="https://spoonacular.com/">Spoonacular</a> through a paid subscription to <a href="https://rapidapi.com/">RapidAPI</a>. Since the involved recipes were in English, a translator service was implemented as well to have Spanish data. </p>
<p>In order to ensure the database of recipes and ingredients as proper quality to implement the given approach, a Data Quality Control was conducted. Check the <a href="../how-to/data_quality_control/">How-to: Data Quality Control</a> document for details. Through <a href="https://github.com/Matech-Studios/Matech.Starvapp.RecipesRecomender.Analytics/blob/main/notebooks/20210130_data_quality_control.ipynb">this notebook</a>, the analysis was done where in general aspects the data observed was fine. However, at that point and in later iterations there were data issues found like:
- Thousands of ingredients, making hard to achieve proper matching rules for the recommender (check <a href="https://github.com/Matech-Studios/Matech.Starvapp.RecipesRecomender.Analytics/blob/develop/notebooks/ingredients_issues.yml">these issues identified</a>)
- Bad translations of the implemented service (also noticed in the previous issues identified)
- Missing information in some fields, especially for instructions of recipes</p>
<p>Therefore, the data sources was marked as <strong>not reliable</strong>, and an extra work was required to identify a new source and scrape recipes data from it. </p>
<h2 id="new-data-source">New data source<a class="headerlink" href="#new-data-source" title="Permanent link">&para;</a></h2>
<p>After reviewing several potential data sources (having fields required by the StarvApp, and without legal restrictions), a new one was found. Therefore, a <a href="https://github.com/Matech-Studios/Matech.Starvapp.RecipesRecomender.Analytics/blob/main/scripts/scraper_plasticwebs.py">scraper script was developed</a> to get datasets from there with <a href="https://github.com/Matech-Studios/Matech.Starvapp.RecipesRecomender.Analytics/blob/main/scripts/plasticwebs_config.yaml">some defined configuration</a>. Here some <strong>important limitations</strong> to know about the scraper:
- Execution must be done manually, with a proper update of the YAML configuration mentioned
- Paths to resulting datasets must be updated in the code as well</p>
<p>The resulting datasets in CSV format were controlled in a new data quality check conducted in <a href="https://github.com/Matech-Studios/Matech.Starvapp.RecipesRecomender.Analytics/blob/main/notebooks/20210630_data_quality_control.ipynb">this notebook</a>, and then shared to the Backend team to a proper upload to the Database of the StarvApp. In addition, the snapshots of datasets obtained were stored in One Drive for availability.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>This data extraction process was part of a <strong>workaround task</strong> handled after finding data issues in Spoonacular. Later work about automation of data extraction from these sources will be required in further steps.</p>
</div>
<p>It is important to mention that ingredients in recipes extracted from this source were not in a normalized basis as in Spoonacular, but they were in format of free text description that required to be processed and classified as described below.</p>
<h2 id="ingredients-classification">Ingredients classification<a class="headerlink" href="#ingredients-classification" title="Permanent link">&para;</a></h2>
<p>Given a free text description of an ingredient, the challenge is to give it a normalized name to make easier the retrieval of recipes for a query of entered ingredients. For example, if you have an ingredient with description "2 cucharadas de aceite de oliva" you expect to classify it as "Aceite de oliva". However, this is not an easy task due to the given aspects that may happen on the text:</p>
<ul>
<li>Information about quantity, size and units that may variate for each kind of recipe (e.g. "1 kg de ajíes morrones rojos grandes")</li>
<li>Information about how the ingredient should be prepared (e.g. "1 cebolla mediana picada fina")</li>
<li>Personal comments about the quality of the ingredient (e.g. "2 hojas de laurel fileteadas (mejor fresco)")</li>
<li>Some ingredients share very similar names (e.g. "Cebolla" &amp; "Cebolla de verdeo", "Aceite" &amp; "Aceite de oliva")</li>
<li>Some ingredients even change of name depending on the region (e.g. "Calabacin" means "Zucchini" in other countries)</li>
</ul>
<p>Therefore, the approach taken was to train a classifier to process a text description and tell which is the corresponding ingredient. To tackle the given complexity in the text, a <a href="https://fasttext.cc/docs/en/supervised-tutorial.html">FastText model</a> was defined due to be easy to adjust but powerful as it is a neural network designed for this purpose. The first step was to prepare a labeled dataset to train and validate the model with 2 fields per record (a text description, and a "label" indicating the expected ingredient classification), which was built as it follows:</p>
<ol>
<li>Label some few records (e.g. 5 per class) by manually indicating which ingredient to put for a given text description</li>
<li>Remove those records for ingredients very specific and hard to find in usual recipes. This means that <strong>only recipes with supported ingredients will be valid in the database</strong>.</li>
<li>Train a model and use it to classify new recors (e.g. 10 per class)</li>
<li>Correct some mislabeled records by manually and loop until you have a bigger labeled dataset (e.g. 100 records per class)</li>
</ol>
<p>A labeled dataset was obtained and stored in One Drive, so then it was used to train a FastText model. A <a href="https://github.com/Matech-Studios/Matech.Starvapp.RecipesRecomender.Analytics/blob/main/starvapprecom/classifier/fasttext.py">script</a> was developed to do that, which does the following steps
- Load labeled dataset
- Pre-process the text descriptions (e.g. apply lowercase, remove special characters and numbers, remove words from a blacklist)
- Split train-test sets for <a href="https://scikit-learn.org/stable/modules/cross_validation.html#cross-validation">cross-validation</a>
- Train model with some defined parameters
- Get results about train and test sets to validate the performance of the model</p>
<p>Once the model was obtained, then it is ready to be used to <a href="https://github.com/Matech-Studios/Matech.Starvapp.RecipesRecomender.Analytics/blob/main/scripts/scraper_plasticwebs.py#L234">classify the extracted recipes</a> to build the database. As a result, we can have the datasets with proper fields and ingredients ready to be used for the application.</p>
<h2 id="recommender-approach">Recommender approach<a class="headerlink" href="#recommender-approach" title="Permanent link">&para;</a></h2>
<!-- Document the approach taken to develop the solution based on the defined requirements and knowledge about the project -->

<p>Given an input from the user with ingredients, and a database with recipes, the idea was to have a recommender system to decide the top of recipes to return with some criteria. In this project, there were two approaches explored in this order:</p>
<ol>
<li>Basic scores</li>
<li>Weight ingredients</li>
</ol>
<p>Both of them were intended for a <a href="https://medium.com/yusp/the-cold-start-problem-for-recommender-systems-89a76505a7">"cold start"</a>, where no users history is available. Therefore, recommendations are obtained only based on the recipes information, not from users.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Following the <a href="https://en.wikipedia.org/wiki/KISS_principle">KISS principle</a>, it is suggested to always start with a very simple approach (even if it is not Machine Learning), and once it is implemented you can collect feedback and data about usage and then refine it.</p>
</div>
<h3 id="approach-1-basic-scores">Approach 1: Basic Scores<a class="headerlink" href="#approach-1-basic-scores" title="Permanent link">&para;</a></h3>
<p>Based on the available data, the decision was to start with a simple approach of basic scoring, in order to accelerate integration and collect early feedback to justify the need for a more complex approach</p>
<h4 id="idea">Idea<a class="headerlink" href="#idea" title="Permanent link">&para;</a></h4>
<p>In this "naive" approach, the idea is to get the recipes with the best score based on the following aspects:</p>
<ul>
<li>Matching of ingredients entered</li>
<li>Ratings of recipes</li>
<li>Cooking time required</li>
</ul>
<p>By tuning the score functions of these aspects, as well as the way to aggregate them, we could have a very quick way to select the best recipes to recommend, in order to be able to start the integration with other services and then have the structure needed to try a better approach.</p>
<h4 id="metrics">Metrics<a class="headerlink" href="#metrics" title="Permanent link">&para;</a></h4>
<p>In order to assess if a set of recommended recipes is appropriate for a set of entered ingredients, these are the aspects to be evaluated:</p>
<ul>
<li>Quality of matched ingredients, by checking average matching ratio of ingredients &gt; 0.5 </li>
<li>Popularity of recipes, by checking average rating &gt; 4.0</li>
<li>Complexity of recipes, by checking average cooking time &lt; 60</li>
</ul>
<p>The problem of this approach is that it does not take into account some concept of relevancy on ingredients involved in a recommended recipe. So, as a result, some "not common" recipes may be selected when having few matches of ingredients for a given input, and that was a not desired aspect that was analyzed to propose a new solution.</p>
<p>More details about approach in <a href="https://github.com/Matech-Studios/starvapp_recipes_recommender/blob/main/notebooks/20201228_basic_approach_scores.ipynb">this Jupyter notebook</a>.</p>
<h3 id="approach-2-weight-ingredients">Approach 2: Weight Ingredients<a class="headerlink" href="#approach-2-weight-ingredients" title="Permanent link">&para;</a></h3>
<p>To tackle the problem of recommendations with not common ingredients when there are few matched ingredients, a new approach was analyzed to "weight" ingredients to achieve a selection of "feasible" recipes on the recommendations delivered.</p>
<h4 id="idea_1">Idea<a class="headerlink" href="#idea_1" title="Permanent link">&para;</a></h4>
<p>Given that context, we could compute some "weights" for the given ingredients on the database, where the idea is to express in a score with range [0, 1] how "common" is an ingredient. Therefore, the recommendations that will select additional ingredients that are not part of the input, could prefer "common" ingredients to be recommended instead of "not common" ones. </p>
<p>So, through an analysis on the data available, ingredients were processed to get frecuency and scale it into a range of [0,1] with a logarithmic scale. The result was saved into a <a href="https://github.com/Matech-Studios/Matech.Starvapp.RecipesRecomender.Analytics/blob/main/data/ingredients_metadata.yml">YAML file</a>, and the approach implemented was simply recommend recipes that:
- Are prone to contain the input ingredients (with high score)
- Are prone to contain "common" ingredients (with the explained score)</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Notice that the YAML file indicates which is the list of supported ingredients, and the relevance they have in the given database.</p>
</div>
<p>Finally, <strong>this was the approach selected to go production</strong>.</p>
<h2 id="service-development">Service development<a class="headerlink" href="#service-development" title="Permanent link">&para;</a></h2>
<p>Once the recommendation approach was defined and developed, the final step is to develop and deploy a service that receives requests from the StarvApp with input of users and returns recipes recommendations. Therefore, a <a href="https://github.com/Matech-Studios/Matech.Starvapp.RecipesRecomender.Analytics/blob/main/scripts/service.py">script</a> was developed with <a href="https://docs.python.org/3/library/asyncio.html">asyncio</a> to do the following steps:</p>
<ol>
<li>Set an asynchronous connection to an existing RabbitMQ queue with <a href="https://aio-pika.readthedocs.io/en/latest/">aio-pika</a> </li>
<li>When a message is received, the service calls the function to process the input ingredients and return the recommended recipes</li>
<li>A response is delivered with the recommendations, on the same RabbitMQ queue. </li>
</ol>
<p>For more details about the integration between services in the application, check the architecture shown in <a href="../2_preparation">Chapter 2</a>.</p>
<p>To test the service before the deployment, another <a href="https://github.com/Matech-Studios/Matech.Starvapp.RecipesRecomender.Analytics/blob/main/scripts/task_random_recipes.py">script</a> was developed to emulate requests with a random input to ensure the service will respond correctly.</p>
<p>To deploy this service, a <a href="https://github.com/Matech-Studios/Matech.Starvapp.RecipesRecomender.Analytics/blob/main/Dockerfile">Dockerfile</a> was developed to install the system and run the service as entrypoint. At the same time, another <a href="https://github.com/Matech-Studios/Matech.Starvapp.RecipesRecomender.Analytics/blob/main/Dockerfile_rabbitmq">Dockerfile</a> was defined to also run the RabbitMQ service for the application. Notice that both services are managed by the DevOps team in their given infrastructure.</p>
<h2 id="testing">Testing<a class="headerlink" href="#testing" title="Permanent link">&para;</a></h2>
<!-- Describe the implemented tests for the solution -->

<p>For this solution, there where two types of testing implemented:</p>
<ul>
<li><strong>Unit testing:</strong> To validate each module or block of code on the <a href="https://github.com/Matech-Studios/Matech.Starvapp.RecipesRecomender.Analytics/tree/main/starvapprecom">starvapprecom</a> package mostly for code coverage purposes, which are implemented as <a href="https://github.com/Matech-Studios/Matech.Starvapp.RecipesRecomender.Analytics/tree/main/tests/unit">simple functions</a> executed by <code>pytest</code>.</li>
<li><strong>System testing:</strong> To validate some <em>functional</em> <a href="https://github.com/Matech-Studios/Matech.Starvapp.RecipesRecomender.Analytics/blob/main/tests/system/test_scenarios_approaches_weight_ingredients.py">tests</a>, as checks over the recommender with a dataset regarding some specific <a href="https://github.com/Matech-Studios/Matech.Starvapp.RecipesRecomender.Analytics/blob/main/tests/system/scenarios.yml">scenarios</a>, each of them having <a href="https://github.com/Matech-Studios/Matech.Starvapp.RecipesRecomender.Analytics/blob/main/tests/system/checks.py">corresponding checks</a>.</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>To run the system tests, a dataset must be available and with a configured valid path</p>
</div>
<h2 id="deployment">Deployment<a class="headerlink" href="#deployment" title="Permanent link">&para;</a></h2>
<!-- Document the work done to deploy the implemented solution in a testing environment for testing purposes -->

<p>The StarvApp has a Continuous Integration (CI) pipeline configured in terms of <a href="https://github.com/Matech-Studios/Matech.Starvapp.RecipesRecomender.Analytics/blob/main/azure_pipelines.yml">Azure pipelines</a> and handled by the DevOps team, so the CI is already managed in this work and the files explained in the Environment section are the contract to ensure correct integration. However, additionally a <a href="https://github.com/Matech-Studios/Matech.Starvapp.RecipesRecomender.Analytics/blob/main/.github/workflows/ci_pipeline.yml">Github Actions workflow</a> was configured for this repository to make the following checks:</p>
<ul>
<li>Smoke testing based on configured tests </li>
<li>Code coverage along the releases</li>
<li>Correct linting  </li>
</ul>
<p>You can check the configuration and current status in the <a href="https://github.com/Matech-Studios/Matech.Starvapp.RecipesRecomender.Analytics/blob/main/README.md">project's README</a>.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
            Back to top
          </a>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../2_preparation/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Chapter 2: Preparation" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Chapter 2: Preparation
            </div>
          </div>
        </a>
      
      
        
        <a href="../4_acceptance/" class="md-footer__link md-footer__link--next" aria-label="Next: Chapter 4: Acceptance" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Chapter 4: Acceptance
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2020 - 2021 Matech Studios
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://github.com/Matech-Studios" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.tabs", "navigation.top", "toc.integrate"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.409db549.min.js", "version": {"provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.56a63758.min.js"></script>
      
    
  </body>
</html>